---
layout: post
title:  "[Graphql] GraphQL클라이언트만들기(2)"
date:   2019-06-21-01:07:00
author: 한만섭
categories: graphql
tags: graphql apollo boost
---

* TOC
{:toc}


> ## 시작하기 전에 
  Redux에서 사용했던 Provider 방식과 유사하기 때문에 Redux를 이해하고 계신 분들은 쉽게 이해하실 수 있을 거라 생각합니다.  
　    

***

　  

> ### Client 뼈대 만들기 
  
  * App.js
    App.js에서는 **ApolloProvider** 와 **react-router-dom**을 이용해 상태에 따라 URL 맵핑을 해주는 작업을 해야합니다.  
    
    * **HashRouter**를 **Router**로 사용하고 실제 경로를 변경 시켜줄 **Route**를 import 해줍니다.  
    * **ApolloProvider**를 이용해 Client를 제공해야하기 때문에 역시 import 해야합니다.  
    * Provider에 연결할 만들었던 **Client**를 import 합니다.  
    * 경로에 필요한 **HOME**과 **Detail**을 import해줍니다. 
    
    흐름 : `Client`를 만들어서 `Provider` 에 연결 후 `Router`안에 실제 경로인 `Route`를 넣어줌 Route안에는 `Query`를 날리는 `Component`가 있음. 
      ```
      import React ,{Component}from 'react';
      import {HashRouter as Router,Route} from 'react-router-dom';
      import {ApolloProvider} from 'react-apollo';
      import client from './apolloClient';
      import Home from './Home';
      import Detail from './Detail';
      import styled from 'styled-components';
      
      class App extends Component {
        render(){
          return (
            <ApolloProvider client={client}>
              <Router>
                <Container >
                  <Route exact={true}  path = {'/'} component={Home}></Route>
                  <Route path = {'/details/:movieId'} component={Detail}></Route>
                </Container>
              </Router>
              {/* <div className="App"/> */}
            </ApolloProvider>
          );
        }
      }
      ```
      
      
  * queries.js
  
    query를 만들 때는 `graphql-tag`사용합니다. 쿼리를 작성하는 방식은 styled component와 비슷합니다. 
    ```
    import gql from 'graphql-tag';

    export  const HOME_PAGE = gql`
        {
      movies(limit:20,rating:8){
        id
        title
        summary
        genres
        rating
        medium_cover_image
         }
        }
    `
    ```
    
  * Home.js
    
    * 여기서는 query를 직접 import 해서 사용해야합니다. `react-apollo`에서 제공하는 query 태그에 제작한 HOME_PAGE라는 query를 넣습니다. 
      그러면 `Query`는 loading, data, error 세가지를 리턴해주는데 이것에 맞는 코딩을 하면 됩니다. ( return 필요)
      
    * Movie 컴포넌트를 만들고 mapping 하는 방법을 까먹어서 잘 기억해놔야 할것 같습니다. 
    
    ```
    import React from 'react';
    import {Query} from 'react-apollo';
    import {HOME_PAGE} from './queries';
    import Movie from './Movie';
    import styled from 'styled-components';

    const Loading = styled.span`
        font-size : 40px;
        font-weight : 600;
    `

    const Error = styled.span`
        font-size : 40px;
        font-weight : 600;
        color : red;
    `

    const Home = () => <Query query={HOME_PAGE}>{({loading, data, error}) => {
        if(loading) return  <Loading>loading...</Loading>
        if(error) return <Error>Error!!!</Error>
        return data.movies.map(movie => <Movie key= {movie.id} title={movie.title} img={movie.medium_cover_image} rating={movie.rating} id={movie.id}></Movie>
    );
    }}</Query>;
    export default Home;
    ```
    
    
  * Movie.js
  
    마지막으로 볼 코드는 Movie인데 여기서는  영화를 눌렀을 경우 상세보기로 가야하는데 그 이벤트를 **react-router-dom**의 **Link**를 사용했는 것
    말고는 없는 것 같습니다. 
    
    ```
       class Movie extends Component {

        render(){
            const {title,rating,img,id} = this.props;
            return (
                <Link to={`/details/${id}/`}>
                    <Card img={img}>
                        <Title>{title} / {rating}⭐️</Title>
                    </Card>
                </Link>
            );
        }
    }
    ```
    
    
    
    
