---
 layout: post
title: "[인스타클론코딩] [App].14 - ReactNative 사진 권한 접근 및 업로드 구현하기 "
date: 2019-08-06-0:23:00
author: 한만섭
categories: clonecoding
tags: react instagram icon react-native expo camera
---

[TOC]



### 1. 앨범 접근 권한 요청 

expo를 이용한 rn 프로젝트를 진행할 때는 expo의 `Permission`을 사용하면 앨범에 접근할 수 있습니다.  

[expo Docs](https://docs.expo.io/versions/latest/sdk/permissions/)  

#### 1-1. 설치    

```bash
expo install expo-permissions
```

![1565020950332](../../../../assets/image/1565020950332.png)

#### 1-2. 사용 

![1565020888492](../../../../assets/image/1565020888492.png)

```js
import * as Permissions from 'expo-permissions';
```



#### 1-3. 접근 권한 허용 함수 만들기 

접근 권한을 허용하기 위해서 함수를 만들어서 사용하려고 합니다.  

![1565021128000](../../../../assets/image/1565021128000.png)

위의 `NOTIFICATION`에 자신이 원하는 접근 권한을 넣어주면 됩니다.  `status`가 `granted`상태 일 경우 권한을 허락한 것 입니다.  

```react
 const requestPermisison = async () => {
    const response = await Permissions.askAsync(Permissions.CAMERA);
    console.log(response);
  };

  useEffect(() => {
    requestPermisison();
  }, []);
```



![1565022762199](../../../../assets/image/1565022762199.png)

![1565022745775](../../../../assets/image/1565022745775.png)

위처럼 요청을 하고 허용하게 되면 `status`가 `granted`가 됩니다.  



#### 1-4. MediaLibrary를 이용해 사진 정보 가져오기 

권한은 허용했으니 이제 앨범에 접근해 사진을 가져와야 합니다. 이 작업을 도와주는 것이 expo의 MediaLibrary입니다. 

[expo Docs](https://docs.expo.io/versions/v34.0.0/sdk/media-library/) 

![1565023043981](../../../../assets/image/1565023043981.png)

* install 

  ```bash
  expo install expo-media-library
  ```

* import 

  ```react
  import * as MediaLibrary from 'expo-media-library';
  ```



#### 1-5. 안드로이드 저장소 권한 허용

```
need READ_EXTERNAL_STORAGE permission
```

위와같은 에러가 발생시 설정에 직접 가서 앱의 저장소 권한을 허용해줍니다.  



#### 1-6. setState

```
 setLoading(true);
      console.log(loading);
```

이렇게 해도 false임 





#### 1-7. state 만들기 

```react
  // 선택된 사진 
  const [selected, setSelected] = useState();
  // 로딩 
  const [loading, setLoading] = useState(false);
  //접근 권한 허용했는지 
  const [hasAllow , setHasAllow] = useState(false);
```



### 2. 사진 로드해서 띄우기 



[contentContainerStyle](https://facebook.github.io/react-native/docs/scrollview.html)

`background-size : cover`과 같은 역할을 해주는 것이 `resizeMode : "contain"`입니다. 

 선택된 사진은 위에 위치하며 아래의 사진을 고르면 교체되는 방식입니다.  



### 3. expo camera사용하기 

expo 카메라를 사용하기 위해서도 역시 권한 요청이 필요합니다.  

#### 3-1. 설치 

```bash
expo install expo-camera
```



#### 3-2. 사용 

```
import { Camera } from 'expo-camera';
```



#### 3-3. 권한 허용 

`CAMERA`에 대한 권한 요청을 하고 `status`의 `granted` 를 통해서 권한 허용 여부를 확인할 수 있습니다.  

```react
const { status } = await Permissions.askAsync(Permissions.CAMERA);
    this.setState({ hasCameraPermission: status === 'granted' });
```



#### 3-4. 카메라 사용 

카메라는 `View`태그 안에 `Camera`태그를 작성해 사용할 수 있습니다. 하지만 카메라를 찍고 저장하는 메소드를 사용하기 위해서는 `ref`를 작성해놓아야 합니다.  

```react
return (
    <View>
      {loading ? (
        <Loader />
      ) : hasAllow ? (
        <Camera
          style={{ width: constants.width, height: constants.height / 1.5 }}
        />
      ) : null}
    </View>
  );
```

권한이 허용되었을 경우 `Camera`를 보여줍니다.  



* ##### `ref`

  ref는 camera의 method를 사용하기 위해서 필요합니다.  

![1565093178206](../../../../assets/image/1565093178206.png)

하지만 위와 같이 작성하지 않고 `useRef()`를 사용하려고 합니다.  

#### 3-5. 사진 촬영

`takePictureAsync`를 통해서 사진을 찍을 수 있습니다. 

#### 3-6. 사진 저장 

사진을 저장하는 것은 앨범을 불러왔던 것과 마찬가지로 `MediaLibrary`를 사용해야 합니다. 

![1565093531427](../../../../assets/image/1565093531427.png)

위 코드는 사진을 찍고 그 사진의 `uri`를 앨점에 저장해주는 코드를 작성한 것입니다.  



